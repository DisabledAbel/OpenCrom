<!DOCTYPE html>
<html>
<head>
  <title>MiniCron</title>
  <style>
    body { font-family: sans-serif; margin:40px; max-width:900px }
    input { padding:8px; margin:4px }
    button { padding:8px 12px }
    table { border-collapse: collapse; width:100%; margin-top:20px }
    td, th { border:1px solid #ddd; padding:8px }
  </style>
</head>
<body>

<h1>MiniCron Dashboard</h1>

<h3>Add Job</h3>
<input id="url" placeholder="https://example.com">
<input id="cron" placeholder="*/5 * * * *">
<button onclick="addJob()">Add</button>

<h3>Jobs</h3>
<table id="jobs"></table>

<h3>Recent Logs</h3>
<table id="logs"></table>

<script>
async function load() {
  const jobs = await fetch("/api/jobs").then(r=>r.json());
  const logs = await fetch("/api/logs").then(r=>r.json());

  document.getElementById("jobs").innerHTML =
    "<tr><th>ID</th><th>URL</th><th>Cron</th><th></th></tr>" +
    jobs.map(j=>`
      <tr>
        <td>${j.id}</td>
        <td>${j.url}</td>
        <td>${j.cron}</td>
        <td><button onclick="del(${j.id})">Delete</button></td>
      </tr>
    `).join("");

  document.getElementById("logs").innerHTML =
    "<tr><th>URL</th><th>Status</th><th>Time</th></tr>" +
    logs.map(l=>`
      <tr>
        <td>${l.url}</td>
        <td>${l.status}</td>
        <td>${new Date(l.ran_at).toLocaleString()}</td>
      </tr>
    `).join("");
}

async function addJob() {
  await fetch("/api/jobs", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      url: document.getElementById("url").value,
      cron: document.getElementById("cron").value
    })
  });
  load();
}

async function del(id) {
  await fetch("/api/jobs/"+id,{ method:"DELETE" });
  load();
}

load();
</script>

</body>
</html>
