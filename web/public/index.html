<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>MiniCron Dashboard</title>

<style>
body{font-family:system-ui;background:#0b0f14;color:#e6edf3;margin:0;}
header{padding:18px 28px;background:#11161d;border-bottom:1px solid #222;display:flex;justify-content:space-between;align-items:center;}
button{background:#238636;border:none;padding:10px 16px;border-radius:6px;color:white;cursor:pointer;font-weight:600;}
button:hover{background:#2ea043;}
.container{display:grid;grid-template-columns:1fr 380px;gap:20px;padding:24px;}
.card{background:#11161d;padding:18px;border-radius:10px;border:1px solid #222;}
h2{margin-top:0;}
table{width:100%;border-collapse:collapse;}
td,th{padding:10px;border-bottom:1px solid #222;text-align:left;}
th{color:#8b949e;}
input{width:100%;padding:10px;border-radius:6px;border:1px solid #333;background:#0b0f14;color:white;margin-top:6px;}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;}
.modal-box{background:#11161d;padding:22px;border-radius:10px;width:420px;}
.logs{height:420px;overflow:auto;font-size:12px;background:#0b0f14;padding:12px;border-radius:6px;}
</style>
</head>

<body>

<header>
<h1>MiniCron</h1>
<button onclick="openModal()">+ New Job</button>
</header>

<div class="container">

<div class="card">
<h2>Scheduled Jobs</h2>
<table>
<thead>
<tr><th>URL</th><th>Cron</th><th>Next Run</th><th></th></tr>
</thead>
<tbody id="jobs"></tbody>
</table>
</div>

<div class="card">
<h2>Recent Logs</h2>
<div class="logs" id="logs"></div>
</div>

</div>

<div class="modal" id="modal">
<div class="modal-box">
<h2>Add Job</h2>

URL
<input id="url">

Cron Expression
<input id="cron" placeholder="*/5 * * * *">

<p style="font-size:12px;color:#8b949e">
Examples:<br>
*/5 * * * * → every 5 minutes<br>
0 * * * * → hourly<br>
0 0 * * * → midnight daily
</p>

<div style="margin-top:14px;display:flex;gap:10px;">
<button onclick="add()">Create</button>
<button onclick="closeModal()" style="background:#444;">Cancel</button>
</div>
</div>
</div>

<script>
const jobsEl=document.getElementById("jobs");
const logsEl=document.getElementById("logs");

function openModal(){modal.style.display="flex";}
function closeModal(){modal.style.display="none";}

async function refresh(){
const jobs=await fetch("/api/jobs").then(r=>r.json());
const logs=await fetch("/api/logs").then(r=>r.json());

jobsEl.innerHTML=jobs.map(j=>`
<tr>
<td>${j.url}</td>
<td>${j.cron}</td>
<td>${j.next_run?new Date(j.next_run).toLocaleString():"-"}</td>
<td><button onclick="del(${j.id})" style="background:#da3633">Delete</button></td>
</tr>`).join("");

logsEl.innerHTML=logs.slice(-30).reverse().map(l=>`
<div>
<b>${l.status}</b> ${l.url}<br>
<small>${l.ran_at}</small>
<hr style="border-color:#222">
</div>`).join("");
}

async function add(){
await fetch("/api/jobs",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({url:url.value,cron:cron.value})});
closeModal();refresh();
}

async function del(id){
await fetch("/api/jobs/"+id,{method:"DELETE"});
refresh();
}

refresh();
setInterval(refresh,5000);
</script>

</body>
</html>
